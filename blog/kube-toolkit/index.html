<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en-us" >

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" /> 
    <title>kube-toolkit: Toolkit for creating gRPC-based CLI tools for Kubernetes, written in Go | radu&#39;s blog</title>
     
    

    <meta name='twitter:card' content='summary'>
<meta name='twitter:site' content='@matei_radu'>
<meta name="twitter:image" content="https://radu-matei.com">
<meta name="twitter:title" content="kube-toolkit: Toolkit for creating gRPC-based CLI tools for Kubernetes, written in Go" />
<meta name="twitter:description" content="Building tools like Helm and Draft for Kubernetes using gRPC and Go" />

<meta name="description" content="Building tools like Helm and Draft for Kubernetes using gRPC and Go" />
    <meta property='og:title' content='kube-toolkit: Toolkit for creating gRPC-based CLI tools for Kubernetes, written in Go - radu&#39;s blog'>
<meta property='og:description' content='Building tools like Helm and Draft for Kubernetes using gRPC and Go'>
<meta property='og:url' content='https://radu-matei.com/blog/kube-toolkit/'>
<meta property='og:site_name' content='radu&#39;s blog'>
<meta property='og:type' content='article'><meta property='og:image' content='https://www.gravatar.com/avatar/7b35cc1e79a4b56517919884a9ea60f2?s=256'><meta property='article:section' content='Blog'><meta property='article:tag' content='kubernetes'><meta property='article:tag' content='golang'><meta property='article:tag' content='grpc'><meta property='article:published_time' content='2017-12-18T00:00:00Z'/><meta property='article:modified_time' content='2017-12-18T00:00:00Z'/>
    <link href="https://radu-matei.com/index.xml" rel="alternate" type="application/rss+xml" title="radu&#39;s blog" /> <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    


    
    


    <link rel="stylesheet" href="/css/github-gist.css">
    <link disabled id="dark-mode-theme" rel="stylesheet" href="/css/dark.css">
    <script src="/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
    
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff"> 
    <link rel="canonical" href="https://radu-matei.com/blog/kube-toolkit/"> 

</head>

<body>
 <section class="section" id="header">
  <div class="container">
    <nav class="nav">
      
      

      <a class="nav-item" href="https://radu-matei.com">
        <h1 class="title is-4">radu&#39;s blog</h1>
      </a>
      

      <a class="nav-item" href="https://radu-matei.com/about">
        <h1 class="title is-5">about</h1>
      </a>

      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          <i class="far fa-moon" id="dark-mode-toggle" style="font-size: 21px;"></i><a class="level-item" aria-label="twitter" title=Twitter
            href="https://twitter.com/matei_radu" target="_blank"
            rel="noopener">
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="github" title=Github
            href="https://github.com/radu-matei" target="_blank"
            rel="noopener">
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    
    <p class="author">
      
    </p>
  </div>
</section>

<section class="section">
    <div class="container">
        <div class="subtitle tags is-6 is-pulled-right">
             
<a class="subtitle is-6" href="/tags/kubernetes">#kubernetes</a>



  
  | <a class="subtitle is-6" href="/tags/golang">#golang</a>
  
  | <a class="subtitle is-6" href="/tags/grpc">#grpc</a>
  
 
        </div>
        
        <h2 class="subtitle is-6"> December 18, 2017. 10 minutes read.  </h2>

        <style type="text/css">
            .brxsmall {
                display: block;
                margin-bottom: -.9em;
            }

        </style>
        <span class="brxsmall"></span>
        <h1 class="title">kube-toolkit: Toolkit for creating gRPC-based CLI tools for Kubernetes, written in Go</h1>

        
        <div class="content">
            


            <!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>If you ever used <a href="https://github.com/kubernetes/helm" target="_blank" rel="noreferrer noopener">Helm</a>
 or <a href="https://github.com/azure/draft" target="_blank" rel="noreferrer noopener">Draft</a>
, you know they are very cool command-line tools that connect to a Kubernetes cluster, more specifically to a server-side component (Tiller in the case of Helm, Draftd for Draft) without exposing ports on the Internet, and allow you to interact with your cluster through gRPC-based services.</p>
<p><a href="https://github.com/radu-matei/kube-toolkit" target="_blank" rel="noreferrer noopener"><code>kube-toolkit</code></a>
 aims to help you build similar tools, acting as a starting point in the journey to building new experiences and tools for Kubernetes.</p>
<blockquote>
<p>This project started as a learning experience / small experiment of mine in building a tool for Kubernetes that allowed you to connect to all major cloud providers - then the Open Broker API became mainstream, and I realized I was reinventing the Service Broker wheel - so decided to take the good parts and make them available to anyone starting to build a Kubernetes tool.</p>
</blockquote>
<h3 id="architecture">Architecture</h3>
<p><a href="https://github.com/radu-matei/kube-toolkit" target="_blank" rel="noreferrer noopener"><code>kube-toolkit</code></a>
 has two major components:</p>
<ul>
<li><code>ktk</code> (short for Kubernetes ToolKit) - client that you install locally</li>
<li><code>ktkd</code> (short for Kuberentes ToolKit Daemon) - server-side component that is deployed on your Kubernetes cluster</li>
</ul>
<p>The <code>kube-toolkit</code> client (<code>ktk</code>) interacts with the server-side component (<code>ktkd</code>) using the Kubernetes API to create authenticated tunnels back to the cluster, using gRPC as the underlying communication protocol. The server runs as a pod in Kubernetes, and since it is only a starting point for future tools, it only knows how to return its version, and showcases how to stream data back to the client.</p>
<p>In order to communicate with the cluster you need to pass the <code>kubeconfig</code> file, and the tool will start a tunnel to the cluster for each command you execute, then will tear it down so there are no open connections to the cluster when no command is executed.</p>
<blockquote>
<p>Please note that there are still lots of things left to add, such as SSL, RBAC support or state management - you are more than welcome to contribute in any way to the project!</p>
</blockquote>
<p>As stated earlier, this tool is based on the great work done by the awesome Helm and Draft teams, and is essentially a stripped down version, written from the ground-up.</p>
<p>Now for the actual implementation and how you can get started, and the first issue I bumped in was gathering the correct dependencies for Kubernetes 1.8:</p>
<h3 id="vendoring-kube-toolkit">Vendoring <code>kube-toolkit</code></h3>
<p>Since this tool was built from the ground-up, the first step was to put together the correct versions of the dependencies to <code>k8s.io/client-go</code>, <code>github.com/kubernetes/helm</code>, <code>k8s.io/api</code>, <code>k8s.io/apimachinery</code> and a bunch more. A trivial step you might say, but in the times of Kubernetes 1.8, this was incredibly frustrating&hellip;</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">For example: Helm v2.7.0, client-go v5.0.0 and Kubernetes v1.8.0 all target 1.8.0 - somehow, apiserver needs the previous beta of client-go...<br><br>It is increasingly frustrating... <a href="https://t.co/kj8HD2aKQZ">pic.twitter.com/kj8HD2aKQZ</a></p>&mdash; Radu Matei (@matei_radu) <a href="https://twitter.com/matei_radu/status/924321387128508419?ref_src=twsrc%5Etfw">October 28, 2017</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>Essentially, during a 4 hour period (is was probably much more than that&hellip;), I was in the process of swapping git commit hashes and plugging them into <code>dep</code>, then trying to compile the project&hellip; Word of advice - check various release branches when working with vendored dependencies of Kubernetes!</p>
<p>After finally getting it to work, <a href="https://github.com/radu-matei/kube-toolkit/blob/master/Gopkg.toml" target="_blank" rel="noreferrer noopener">I ended up with a  Gopkg.toml you can find here</a>
 and I simply included the <code>vendor</code> folder in the repo to ensure reproducible builds.</p>
<blockquote>
<p>Please note that this setup is for Kubernetes release 1.8 - you are more than welcome to port the dependencies to release 1.9!</p>
</blockquote>
<blockquote>
<p>Having the <code>vendor</code> folder in the repo significantly increases the size of the repo, but if you ask me, this is a small price to pay for having really reproducible builds - you can put it in <code>.gitignore</code> if you want to.</p>
</blockquote>
<h2 id="defining-and-using-grpc-services">Defining and using gRPC services</h2>
<blockquote>
<p>If you&rsquo;re not familiar with gRPC for Go, there is a <a href="https://grpc.io/docs/tutorials/basic/go.html" target="_blank" rel="noreferrer noopener">great basics tutorial you can get started with</a>
 and understand how to use the client and server.</p>
</blockquote>
<p>In its current form, <a href="https://github.com/radu-matei/kube-toolkit/releases/tag/v0.1" target="_blank" rel="noreferrer noopener"><code>v0.1</code></a>
, the service is able to return the server and client version and showcase how to stream some data - <a href="https://github.com/radu-matei/kube-toolkit/blob/master/pkg/rpc/rpc.proto" target="_blank" rel="noreferrer noopener">essentially, the <code>.proto</code> looks like this</a>
:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">syntax</span> = <span style="color:#e6db74">&#34;proto3&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">rpc</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">service</span> <span style="color:#a6e22e">KTK</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rpc</span> <span style="color:#a6e22e">GetVersion</span>(<span style="color:#a6e22e">Empty</span>) <span style="color:#a6e22e">returns</span> (<span style="color:#a6e22e">Version</span>){}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rpc</span> <span style="color:#a6e22e">ServerStream</span>(<span style="color:#a6e22e">Empty</span>) <span style="color:#a6e22e">returns</span>(<span style="color:#a6e22e">stream</span> <span style="color:#a6e22e">StreamingMessage</span>){}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">message</span> <span style="color:#a6e22e">Version</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">string</span> <span style="color:#a6e22e">sem_ver</span> = <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">string</span> <span style="color:#a6e22e">git_commit</span> = <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">message</span> <span style="color:#a6e22e">StreamingMessage</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">string</span> <span style="color:#a6e22e">message</span> = <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This defines a service with two methods, <code>GetVersion</code> and <code>ServerStream</code> (which returns a stream of <code>StreamingMessage</code> back to the client), and <strong>this is the place where you will first define your service methods!</strong></p>
<p>Now if we take a look at the <a href="https://github.com/radu-matei/kube-toolkit/blob/master/Makefile" target="_blank" rel="noreferrer noopener"><code>Makefile</code></a>
, there is an <code>rpc</code> target that will use the <code>protoc</code> compiler and build the client and server in Golang for our service in <code>pkg/rpc</code> (as defined in the <code>Makefile</code>).</p>
<p>Now it&rsquo;s about creating actual implementations for the client and server. <a href="https://github.com/radu-matei/kube-toolkit/blob/master/pkg/ktk/client.go#L40" target="_blank" rel="noreferrer noopener">For example, the client implementation for <code>GetVersion</code> is as straightforward as simply as calling the <code>GetVersion</code> on the generated client</a>
:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// GetVersion returns the ktk version
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">client</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Client</span>) <span style="color:#a6e22e">GetVersion</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">rpc</span>.<span style="color:#a6e22e">Version</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">RPC</span>.<span style="color:#a6e22e">GetVersion</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">rpc</span>.<span style="color:#a6e22e">Empty</span>{})
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This function call will simply return the version from the server - note that we have to <a href="https://github.com/radu-matei/kube-toolkit/blob/master/pkg/ktkd/server.go#L74" target="_blank" rel="noreferrer noopener">implement the server method as below</a>
:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// GetVersion returns the current version of the server.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">server</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Server</span>) <span style="color:#a6e22e">GetVersion</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">rpc</span>.<span style="color:#a6e22e">Empty</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">rpc</span>.<span style="color:#a6e22e">Version</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Debugf</span>(<span style="color:#e6db74">&#34;executing ktkd version&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">rpc</span>.<span style="color:#a6e22e">Version</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">SemVer</span>:    <span style="color:#a6e22e">version</span>.<span style="color:#a6e22e">SemVer</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">GitCommit</span>: <span style="color:#a6e22e">version</span>.<span style="color:#a6e22e">GitCommit</span>}, <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>The version and commit hash are injected at build time through compile flags. See Makefile.</p>
</blockquote>
<p>Now let&rsquo;s take a look at some streaming messages - <a href="https://github.com/radu-matei/kube-toolkit/blob/master/pkg/ktkd/server.go#L82" target="_blank" rel="noreferrer noopener">first the server</a>
:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// ServerStream starts a new stream from the server
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">server</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Server</span>) <span style="color:#a6e22e">ServerStream</span>(<span style="color:#a6e22e">_</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">rpc</span>.<span style="color:#a6e22e">Empty</span>, <span style="color:#a6e22e">stream</span> <span style="color:#a6e22e">rpc</span>.<span style="color:#a6e22e">KTK_ServerStreamServer</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Debugf</span>(<span style="color:#e6db74">&#34;received server stream command&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; <span style="color:#ae81ff">5</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">stream</span>.<span style="color:#a6e22e">Send</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">rpc</span>.<span style="color:#a6e22e">StreamingMessage</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Message</span>: <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;Sending stream back to client, iteration: %d&#34;</span>, <span style="color:#a6e22e">i</span>),
</span></span><span style="display:flex;"><span>		})
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Sleep</span>(<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This will send 5 messages back to the client, 2 seconds apart.</p>
<p><a href="https://github.com/radu-matei/kube-toolkit/blob/master/pkg/ktk/client.go#L49" target="_blank" rel="noreferrer noopener">Receiving the stream is done like this</a>
:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// ServerStream starts a stream from the server
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">client</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Client</span>) <span style="color:#a6e22e">ServerStream</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">opts</span> <span style="color:#f92672">...</span><span style="color:#a6e22e">grpc</span>.<span style="color:#a6e22e">CallOption</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Debugf</span>(<span style="color:#e6db74">&#34;called InitializeCloud client method...&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">stream</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">RPC</span>.<span style="color:#a6e22e">ServerStream</span>(<span style="color:#a6e22e">ctx</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">rpc</span>.<span style="color:#a6e22e">Empty</span>{})
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;cannot start server stream: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">message</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">stream</span>.<span style="color:#a6e22e">Recv</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">EOF</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;error receiving stream: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">message</span>.<span style="color:#a6e22e">Message</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>With this proto service, you should have a clear understanding on how to write additional methods for the gRPC service and implement the client and the server.</p>
<p>Now that you have a pretty good understanding on how to write gRPC client and server methods, let&rsquo;s explore how to connect to the Kubernetes cluster.</p>
<h3 id="connecting-to-the-kubernetes-cluster">Connecting to the Kubernetes cluster</h3>
<p>For this part, I will <a href="https://github.com/Azure/draft/blob/master/pkg/draftd/portforwarder/portforwarder.go" target="_blank" rel="noreferrer noopener">give 100% credits to the Draft team</a>
 as I merely copied their implementation of a port forwarder that uses the Helm packages.</p>
<p>Essentially, this creates a new &ldquo;SSH-like tunnel&rdquo; back to a pod in the Kubernetes cluster - normally, the pod is the one running our server-side component, <code>ktkd</code> (you have to specify the name and labels for it):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">//New returns a tunnel to the ktkd pod.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">New</span>(<span style="color:#a6e22e">clientset</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">kubernetes</span>.<span style="color:#a6e22e">Clientset</span>, <span style="color:#a6e22e">config</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">restclient</span>.<span style="color:#a6e22e">Config</span>, <span style="color:#a6e22e">namespace</span> <span style="color:#66d9ef">string</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">kube</span>.<span style="color:#a6e22e">Tunnel</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">podName</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">getKTKDPodName</span>(<span style="color:#a6e22e">clientset</span>, <span style="color:#a6e22e">namespace</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Debugf</span>(<span style="color:#e6db74">&#34;found pod: %s&#34;</span>, <span style="color:#a6e22e">podName</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// the default port for ktkd is 10000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ktkdPort</span> = <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// this gets a tunnel to the ktkd pod, port 10000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">t</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">kube</span>.<span style="color:#a6e22e">NewTunnel</span>(<span style="color:#a6e22e">clientset</span>.<span style="color:#a6e22e">CoreV1</span>().<span style="color:#a6e22e">RESTClient</span>(), <span style="color:#a6e22e">config</span>, <span style="color:#a6e22e">namespace</span>, <span style="color:#a6e22e">podName</span>, <span style="color:#a6e22e">ktkdPort</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">t</span>, <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">ForwardPort</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This tunnel is created for every executed command, and allows us to execute commands against <code>localhost:some-random-port</code> and then it forwards the request to <code>ktkdpod-internal-ip:10000</code>. As stated earlier, behind the scenes it uses the Go client for Kubernetes and packages from Helm.</p>
<blockquote>
<p>Please note that there is no need to publicly expose any port on the pod.</p>
</blockquote>
<h3 id="using-cobra-folder-structure-and-adding-your-own-commands">Using cobra, folder structure and adding your own commands</h3>
<p>Both the client and the server are essentially <a href="https://github.com/spf13/cobra" target="_blank" rel="noreferrer noopener"><code>cobra</code></a>
 CLI apps.</p>
<blockquote>
<p>If you are not familiar with cobra, it is a library created by <a href="https://github.com/spf13" target="_blank" rel="noreferrer noopener">Steve Francia, or @spf13</a>
 for creating CLI apps, and tools like Kubernetes, Docker, rkt, etcd or Hugo are built upon cobra.</p>
</blockquote>
<p>Let&rsquo;s have a look at the folder structure:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">kube-toolkit</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">└───cmd</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└───ktk</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">|</span>    <span style="color:#960050;background-color:#1e0010">│---</span> <span style="color:#960050;background-color:#1e0010">ktk.go</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">|</span>    <span style="color:#960050;background-color:#1e0010">│---</span> <span style="color:#960050;background-color:#1e0010">serverStream.go</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">|</span>    <span style="color:#960050;background-color:#1e0010">│---</span> <span style="color:#960050;background-color:#1e0010">version.go</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└───ktkd</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>        <span style="color:#960050;background-color:#1e0010">│---</span> <span style="color:#960050;background-color:#1e0010">ktkd.go</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>        <span style="color:#960050;background-color:#1e0010">│---</span> <span style="color:#960050;background-color:#1e0010">start.go</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">└───pkg</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└───ktk</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">|</span>    <span style="color:#960050;background-color:#1e0010">│---</span> <span style="color:#960050;background-color:#1e0010">client.go</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└───ktkd</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">|</span>    <span style="color:#960050;background-color:#1e0010">│---</span> <span style="color:#960050;background-color:#1e0010">server.go</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└───portforwarder</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">|</span>    <span style="color:#960050;background-color:#1e0010">│---</span> <span style="color:#960050;background-color:#1e0010">portforwarder.go</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└───rpc</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">|</span>    <span style="color:#960050;background-color:#1e0010">│---</span> <span style="color:#960050;background-color:#1e0010">rpc.proto</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">|</span>   <span style="color:#960050;background-color:#1e0010">|</span>    <span style="color:#960050;background-color:#1e0010">|---</span> <span style="color:#960050;background-color:#1e0010">rpc.pb.go</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">└───version</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">│</span>   <span style="color:#960050;background-color:#1e0010">|</span>    <span style="color:#960050;background-color:#1e0010">│---</span> <span style="color:#960050;background-color:#1e0010">version.go</span>
</span></span></code></pre></div><p>In the <code>cmd</code> directory we have the CLIs for <code>ktk</code> and <code>ktkd</code>, and in <code>pkg</code> we have all packages that we use throughout the tool - the implementations for the gRPC client and server, the port forwarder, the generated Go service and proto.</p>
<p>Let&rsquo;s take a look at how everything works together for the version command:</p>
<ul>
<li>first of all, I briefly mentioned that the version and git commit are injected at build time using compilation flags - the <code>LFFLAGS</code> inject into <code>GitCommit</code>and <code>SemVer</code> the respective values from the <code>version</code> package from <code>pkg</code> into both the client and the server (which can have different versions!):</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-makefile" data-lang="makefile"><span style="display:flex;"><span>VERSION_PACKAGE <span style="color:#f92672">=</span> github.com/radu-matei/kube-toolkit/pkg/version
</span></span><span style="display:flex;"><span>LDFLAGS <span style="color:#f92672">+=</span> -X <span style="color:#66d9ef">$(</span>VERSION_PACKAGE<span style="color:#66d9ef">)</span>.GitCommit<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>GIT_COMMIT<span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>LDFLAGS <span style="color:#f92672">+=</span> -X <span style="color:#66d9ef">$(</span>VERSION_PACKAGE<span style="color:#66d9ef">)</span>.SemVer<span style="color:#f92672">=</span><span style="color:#e6db74">${</span>SEMVER<span style="color:#e6db74">}</span>
</span></span></code></pre></div><blockquote>
<p>There is a <a href="https://blog.alexellis.io/inject-build-time-vars-golang/" target="_blank" rel="noreferrer noopener">great article by Alex Ellis explaining everything about injecting build-time variables</a>
</p>
</blockquote>
<ul>
<li>earlier we saw the client and the server implementation of <code>GetVersion</code></li>
</ul>
<p>Now let&rsquo;s see how to put together the server app:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">newStartCmd</span>(<span style="color:#a6e22e">out</span> <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Writer</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">startCmd</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">startCmd</span>{}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Use</span>:   <span style="color:#e6db74">&#34;start&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Short</span>: <span style="color:#a6e22e">startUsage</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Long</span>:  <span style="color:#a6e22e">startUsage</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">RunE</span>: <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">cobra</span>.<span style="color:#a6e22e">Command</span>, <span style="color:#a6e22e">args</span> []<span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">startCmd</span>.<span style="color:#a6e22e">run</span>()
</span></span><span style="display:flex;"><span>		},
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flags</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">Flags</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flags</span>.<span style="color:#a6e22e">StringVar</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">listenAddress</span>, <span style="color:#e6db74">&#34;listen-addr&#34;</span>, <span style="color:#e6db74">&#34;0.0.0.0:10000&#34;</span>, <span style="color:#e6db74">&#34;the ktkd server listen address&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">cmd</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">startCmd</span>) <span style="color:#a6e22e">run</span>() <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">cfg</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">ktkd</span>.<span style="color:#a6e22e">ServerConfig</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ListenAddress</span>: <span style="color:#a6e22e">listenAddress</span>,
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">ktkd</span>.<span style="color:#a6e22e">NewServer</span>(<span style="color:#a6e22e">cfg</span>).<span style="color:#a6e22e">Serve</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>())
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We will simply call <code>ktkd start</code>, which will start the gRPC server and we will be ready to accept incoming requests from clients.</p>
<ul>
<li>now the cobra <code>run</code> method for <code>ktk version</code>:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">cmd</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">versionCmd</span>) <span style="color:#a6e22e">run</span>() <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Debugf</span>(<span style="color:#e6db74">&#34;making request to: %s&#34;</span>, <span style="color:#a6e22e">ktkdHost</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">conn</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ktk</span>.<span style="color:#a6e22e">GetGRPCConnection</span>(<span style="color:#a6e22e">ktkdHost</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatalf</span>(<span style="color:#e6db74">&#34;cannot create grpc connection: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">conn</span>.<span style="color:#a6e22e">Close</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">client</span> = <span style="color:#a6e22e">ensureKTKClient</span>(<span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">client</span>, <span style="color:#a6e22e">conn</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ktkdVersion</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">cmd</span>.<span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">GetVersion</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Background</span>())
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Errorf</span>(<span style="color:#e6db74">&#34;cannot get ktkd version: %v&#34;</span>, <span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;ktk Semver: %s GitCommit: %s\n&#34;</span>, <span style="color:#a6e22e">version</span>.<span style="color:#a6e22e">SemVer</span>, <span style="color:#a6e22e">version</span>.<span style="color:#a6e22e">GitCommit</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;ktkd SemVer:  %s Git Commit: %s\n&#34;</span>, <span style="color:#a6e22e">ktkdVersion</span>.<span style="color:#a6e22e">SemVer</span>, <span style="color:#a6e22e">ktkdVersion</span>.<span style="color:#a6e22e">GitCommit</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>here, we get an instance of the gRPC client, then call the server for its version. Then we simply print the version.</li>
</ul>
<p>For every new functionality, we need to add a new cobra command (and remember to add it to the root command) and implement it accordingly.</p>
<h3 id="see-in-in-action">See in in action</h3>
<p>First of all, you need to deploy the <code>ktkd</code> pod to a Kubernetes cluster.</p>
<blockquote>
<p>As of right now, there isn&rsquo;t an automated way to deploy this to Kubernetes, <a href="https://github.com/radu-matei/kube-toolkit/issues/9" target="_blank" rel="noreferrer noopener">but there is an open issue for anyone that wants to contribute!</a>
</p>
</blockquote>
<p>First, you need to <code>make ktkd-linux</code> - this will create the linux binary that we will then package into a Docker container and deploy to the cluster - <code>docker build -t your-username/ktkd</code>. Then, deploy this to Kubernetes:</p>
<p><img src="/img/article-photos/kube-toolkit/pod.jpg" alt=""></p>
<blockquote>
<p>Notice there is not port exposed!</p>
</blockquote>
<blockquote>
<p>You can easily do this using <code>kubectl</code></p>
</blockquote>
<p>Then, we need to build our client: <code>make ktk</code>, then, passing the <code>kubeconfig</code> file, attempt to get the version:</p>
<p><img src="/img/article-photos/kube-toolkit/ktk.jpg" alt=""></p>
<blockquote>
<p>Remember to pass the path to your <code>kubeconfig</code> file!</p>
</blockquote>
<h2 id="conclusion">Conclusion</h2>
<p>And just like this, we managed to get a tool that connects to a Kubernetes cluster from a CLI application through tunnels and gRPC! You can now build your own functionality on top of this, extend the proto service and implement the client and server!</p>
<p>This started with me looking at Helm and Draft and trying to understand how to build a similar tool and trying to understand all concepts involved. It is by no means as complex as Helm and Draft (it actually removes some abstraction compared to Draft, in that this tool uses directly the generated gRPC client) and it should serve as a starting point building the next awesome tool for Kubernetes!</p>
<p>You are invited to <a href="https://github.com/radu-matei/kube-toolkit" target="_blank" rel="noreferrer noopener">contribute on the GitHub repo, tackle some of the issues there and provide your feedback!</a>
</p>
<p>I would love to hear your thoughts - feel free to comment below, <a href="/contact">or send me an email</a>
</p>


            
            <p class="author"><a href="https://twitter.com/matei_radu" target="_blank"
                    rel="noreferrer">Radu Matei<br>
                    <small>@matei_radu</a></small>
            </p>

            
        </div>
        
    </div>
</section>

<section class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="https://twitter.com/matei_radu" rel="noreferrer" target="_blank">Radu Matei</a> 2023</p>
    
  </div>

</section>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-81142224-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>





<script src="/js/dark.js "></script>


</body>

</html>

